<div class="container p-4 bg-white">
    <div class="text-center p-3 mb-4 align-items-center">
        <h2>Gestión de Usuarios del Sistema</h2>
        <a class="" href="/links/panel/historial/sistem">Ver historico de todo el Sistema</a>
    </div>
        <table class="table table-hover">
            <thead>
                <tr>
                    <th scope="col">AD</th>
                    <th scope="col">RRFF</th>
                    <th scope="col">Rol</th>
                    <th scope="col">Avtivo</th>
                    <th scope="col">Acción</th>
                </tr>
            </thead>
            <tbody>
    {{#each persona}}
                <tr>
                    <td>{{ad}}</td>
                    <td>{{rrff}}</td>
                    <td>{{rol}}</td>
                    {{#if activo}}
                    <td class="text-success">Activo</td>
                    {{else}}
                    <td class="text-danger">Bloqueado</td>
                    {{/if}}
                    <td>
                        <a href="/links/historial/{{idPersona}}" class="btn btn-warning btn-sm">Ver Historial</a>
                        <a href="/links/admin/profile/{{idPersona}}" class="btn btn-success btn-sm" style="margin-right: -80px">Modificar Perfil</a>
                    </td>
                </tr>
    {{/each}}
            </tbody>
        </table>
</div>
<script>
    var btn = document.getElementById('agregar');
    var invalid = document.getElementById('invalid');
    var nit = document.getElementById('nit');
    var contenido = document.querySelector('ol.list-group.list-group-numbered');

    function verificarNit() {
        nit.value = Number(nit.value);
        if (nit.value.length > 4) {
            socket.emit('cliente:verifNit', nit.value);
        } else {
            invalid.innerHTML = "NIT muy corto";
            nit.className = 'form-control is-invalid';
            btn.disabled = true;
        }
        //console.log(nit.value);
    }
    function agregarNit() {
        nit.value = Number(nit.value);
        socket.emit('cliente:registrarNit', nit.value);
    }
    function nitDiv(id, nit, newNit) {
        const div = document.createElement("li");
        div.innerHTML = `
            --> ${nit}
            <div class="text-end">
                <button type="button" onclick="eliminar(${id})" class="btn btn-outline-danger" disabled>Eliminar</button>
            </div>
        `;
        if (nit == newNit) {
            div.className = 'list-group-item list-group-item-success list-group-item-action';
            div.innerHTML += `Nit nuevo Agregado Exitosamente`
        } else {
            div.className = 'list-group-item list-group-item-action';
        }

        return div;
    }
    function eliminar(id) {
        socket.emit('cliente:eliminarNit', id);
    }

    //sockets
    socket.on('server:nitLibre', () => {
        //invalid.innerHTML = "NIT disponible.";
        nit.className = 'form-control is-valid';
        btn.disabled = false;
    });
    socket.on('server:nitUsado', () => {
        invalid.innerHTML = "Este NIT ya EXISTE, usa otro.";
        nit.className = 'form-control is-invalid';
        btn.disabled = true;
    });
    socket.on('server:nitRegistrado', (nit1, nits) => {

        var span = document.querySelector('.badge.text-bg-danger');
        if (nit1 == null) {
            span.style.display = '';
        } else {
            span.style.display = 'none';
        }
        contenido.innerHTML = "";
        nits.forEach(async function (element, index) {
            contenido.append(nitDiv(element.idNit, element.nit, nit1));
        });
        nit.value = '';
        invalid.innerHTML = "NIT muy corto";
        nit.className = 'form-control is-invalid';
        btn.disabled = true;
    });
</script>